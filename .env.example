# ============================================================
# Redis Configuration
# ============================================================
# Redis Mode: 'standalone' (default) or 'sentinel' (HA)
REDIS_MODE=standalone

# Standalone Redis Configuration
REDIS_URL=redis://localhost:6379
REDIS_MAX_CONNECTIONS=50           # Maximum connections in pool
REDIS_SOCKET_TIMEOUT=5             # Socket timeout in seconds
REDIS_SOCKET_CONNECT_TIMEOUT=5     # Connection timeout in seconds
REDIS_SOCKET_KEEPALIVE=true        # Enable TCP keepalive
REDIS_RETRY_ON_TIMEOUT=true        # Retry on timeout errors
REDIS_HEALTH_CHECK_INTERVAL=30     # Health check interval in seconds

# Sentinel Configuration (for High Availability)
# Uncomment and configure when REDIS_MODE=sentinel
# REDIS_SENTINEL_HOSTS=sentinel-0:26379,sentinel-1:26379,sentinel-2:26379
# REDIS_SENTINEL_MASTER=mymaster
# REDIS_SENTINEL_PASSWORD=          # Optional: Sentinel auth password
# REDIS_PASSWORD=                   # Optional: Redis auth password
# REDIS_DB=0                        # Redis database number

# ============================================================
# OpenSearch Configuration (for Hybrid Search)
# ============================================================
OPENSEARCH_URL=http://localhost:9200

# ============================================================
# Semantic Matching Configuration
# ============================================================
SIMILARITY_THRESHOLD=0.5  # Minimum cosine similarity for matches (0-1)
MAX_MATCHES=10            # Maximum number of matches per need

# ============================================================
# Hybrid Search Configuration
# ============================================================
HYBRID_SEARCH_ENABLED=false        # Enable BM25 + semantic hybrid search
RRF_K=60                          # Reciprocal Rank Fusion parameter
VECTOR_BOOST=1.0                  # Weight for semantic search (1.0 = equal weight)

# ============================================================
# Context Size Limits
# ============================================================
MAX_CONTEXT_SIZE=51200    # Maximum context size in tokens (~40% of 128k window)

# ============================================================
# Authentication & Authorization
# ============================================================
API_KEY_SALT=                      # Salt for API key hashing (REQUIRED for production, min 16 chars)
                                   # Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"

# Bootstrap Admin (first startup only, when no API keys exist)
# BOOTSTRAP_ADMIN_KEY=             # Optional: specific admin API key to create (starts with "ck_")
                                   # If not set, auto-generates and displays in logs (ONE TIME ONLY)
# BOOTSTRAP_ADMIN_NAME=root        # Name for bootstrap admin account (default: "root")
# BOOTSTRAP_ADMIN_EMAIL=           # Optional: email for audit trail (default: "bootstrap@contex.local")

# ============================================================
# Rate Limiting
# ============================================================
RATE_LIMIT_ENABLED=true            # Enable rate limiting protection
RATE_LIMIT_REQUESTS=100            # Maximum requests per window
RATE_LIMIT_WINDOW=60               # Rate limit window in seconds

# ============================================================
# Graceful Degradation Configuration
# ============================================================
DEGRADATION_HEALTH_CHECK_INTERVAL=5.0   # Health check interval in seconds
DEGRADATION_FAILURE_THRESHOLD=3          # Failures before degrading
DEGRADATION_RECOVERY_THRESHOLD=2         # Successes before recovering
DEGRADATION_ENABLE_FALLBACK_CACHE=true   # Enable in-memory fallback cache

# ============================================================
# Logging Configuration
# ============================================================
LOG_LEVEL=INFO            # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_JSON=true             # Enable JSON-structured logging for production

# ============================================================
# CORS Configuration
# ============================================================
CORS_ORIGINS=*                     # Comma-separated origins (* for all - insecure for production)
CORS_ALLOW_CREDENTIALS=true        # Allow credentials in CORS requests

# ============================================================
# Security Headers Configuration
# ============================================================
ENABLE_HSTS=true                   # Enable HTTP Strict Transport Security

# ============================================================
# Sentry Error Tracking Configuration
# ============================================================
# SENTRY_DSN=                        # Sentry DSN (required to enable Sentry)
# SENTRY_ENVIRONMENT=development     # Environment name (development, staging, production)
# SENTRY_RELEASE=contex@0.2.0        # Release version
# SENTRY_SAMPLE_RATE=1.0             # Error sampling rate (0.0-1.0)
# SENTRY_TRACES_SAMPLE_RATE=0.1      # Performance traces sampling rate
# SENTRY_PROFILES_SAMPLE_RATE=0.1    # Profiling sampling rate
# SENTRY_ENABLE_TRACING=true         # Enable performance monitoring

# ============================================================
# Distributed Tracing Configuration
# ============================================================
OTEL_EXPORTER_OTLP_ENDPOINT=       # OpenTelemetry collector endpoint (optional)
OTEL_SERVICE_NAME=contex           # Service name for tracing
OTEL_TRACES_SAMPLER=parentbased_traceidratio  # Sampling strategy
OTEL_TRACES_SAMPLER_ARG=1.0        # Sample ratio (1.0 = 100%)

# ============================================================
# Secrets Management Configuration
# ============================================================
# Secrets are loaded from providers in order: Vault -> AWS Secrets Manager -> Environment

# HashiCorp Vault Configuration
# VAULT_ADDR=https://vault.example.com:8200  # Vault server address
# VAULT_TOKEN=                               # Vault token (for token auth)
# VAULT_ROLE_ID=                             # AppRole role ID (for AppRole auth)
# VAULT_SECRET_ID=                           # AppRole secret ID (for AppRole auth)
# VAULT_KUBERNETES_ROLE=                     # Kubernetes role (for K8s auth)
# VAULT_MOUNT_POINT=secret                   # KV secrets engine mount point
# VAULT_NAMESPACE=                           # Vault namespace (enterprise)

# AWS Secrets Manager Configuration
# AWS_REGION=us-east-1                       # AWS region (also uses AWS_DEFAULT_REGION)
# AWS_ACCESS_KEY_ID=                         # AWS access key (optional, uses IAM role if not set)
# AWS_SECRET_ACCESS_KEY=                     # AWS secret key (optional)
# AWS_SECRETS_PREFIX=contex/                 # Prefix for secret names in AWS

# ============================================================
# Multi-Tenancy Configuration
# ============================================================
MULTI_TENANT_ENABLED=false                   # Enable multi-tenant mode (true/false)
                                             # When false, uses 'default' tenant for all requests
                                             # When true, requires tenant identification via:
                                             #   - X-Tenant-ID header
                                             #   - API key association
                                             #   - Path prefix (/t/{tenant_id}/...)

# Tenant Plans and Quotas (configured per tenant)
# Plan tiers: free, starter, pro, enterprise
# Each tier has different quotas for:
#   - max_projects: Maximum number of projects
#   - max_agents_per_project: Maximum agents per project
#   - max_api_keys: Maximum API keys
#   - max_events_per_month: Monthly event limit
#   - max_storage_mb: Storage limit in MB
#   - max_requests_per_minute: Rate limit

# ============================================================
# Audit Logging Configuration
# ============================================================
AUDIT_RETENTION_DAYS=90                      # How long to retain audit events (default 90 days)
                                             # Set higher for compliance requirements
                                             # Events are stored in Redis with automatic expiration

# ============================================================
# OAuth2/OIDC Configuration
# ============================================================
# Configure one or more OAuth providers for enterprise SSO
# Each provider requires CLIENT_ID and CLIENT_SECRET at minimum
# Provider-specific options documented below

# Contex base URL (used for OAuth callbacks)
# CONTEX_BASE_URL=https://contex.example.com

# Google OAuth (https://console.cloud.google.com/apis/credentials)
# OAUTH_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
# OAUTH_GOOGLE_CLIENT_SECRET=your-client-secret

# GitHub OAuth (https://github.com/settings/developers)
# OAUTH_GITHUB_CLIENT_ID=your-client-id
# OAUTH_GITHUB_CLIENT_SECRET=your-client-secret

# Microsoft Azure AD (https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps)
# OAUTH_AZURE_AD_CLIENT_ID=your-client-id
# OAUTH_AZURE_AD_CLIENT_SECRET=your-client-secret
# OAUTH_AZURE_AD_TENANT_ID=your-tenant-id     # Use 'common' for multi-tenant

# Okta (https://developer.okta.com/)
# OAUTH_OKTA_CLIENT_ID=your-client-id
# OAUTH_OKTA_CLIENT_SECRET=your-client-secret
# OAUTH_OKTA_DOMAIN=your-domain.okta.com      # Without https://

# ============================================================
# Service Accounts Configuration
# ============================================================
# Service accounts enable machine-to-machine authentication
# for CI/CD pipelines, integrations, and automated systems

# JWT secret for signing service account tokens (REQUIRED for production)
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
# SERVICE_ACCOUNT_JWT_SECRET=your-secret-key

# ============================================================
# Data Versioning Configuration
# ============================================================
# Contex automatically versions all published data
# This enables rollback, diff, and audit trail capabilities

DATA_VERSIONING_ENABLED=true                 # Enable automatic data versioning
DATA_MAX_VERSIONS=100                        # Maximum versions to retain per data key
                                             # Older versions are automatically cleaned up
                                             # Set higher for compliance requirements

# ============================================================
# Webhook Configuration
# ============================================================
# Webhooks enable real-time event notifications to external systems
# Supports filtering by event type, category, and project

WEBHOOKS_ENABLED=true                        # Enable webhook system
WEBHOOK_TIMEOUT=30                           # HTTP request timeout in seconds
WEBHOOK_MAX_RETRIES=3                        # Maximum retry attempts for failed deliveries
                                             # Uses exponential backoff (2^attempt seconds)